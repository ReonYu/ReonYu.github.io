<!doctype html>



  


<html class="theme-next muse use-motion" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">



<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">















  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css">




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css">


  <meta name="keywords" content="code,">








  <link rel="shortcut icon" type="image/x-icon" href="/images/avatar.png?v=5.1.0">






<meta name="description" content="Dubbo领域模型在 Dubbo 的核心领域模型中：  Protocol 是服务域，它是 Invoker 暴露和引用的主功能入口，它负责 Invoker 的生命周期管理。 Invoker 是实体域，它是 Dubbo 的核心模型，其它模型都向它靠扰，或转换成它，它代表一个可执行体，可向它发起 invoke 调用，它有可能是一个本地的实现，也可能是一个远程的实现，也可能一个集群实现。 Invocati">
<meta name="keywords" content="code">
<meta property="og:type" content="article">
<meta property="og:title" content="dubbo 相关">
<meta property="og:url" content="http://yoursite.com/2018/08/22/dubbo-相关/index.html">
<meta property="og:site_name" content="Leon">
<meta property="og:description" content="Dubbo领域模型在 Dubbo 的核心领域模型中：  Protocol 是服务域，它是 Invoker 暴露和引用的主功能入口，它负责 Invoker 的生命周期管理。 Invoker 是实体域，它是 Dubbo 的核心模型，其它模型都向它靠扰，或转换成它，它代表一个可执行体，可向它发起 invoke 调用，它有可能是一个本地的实现，也可能是一个远程的实现，也可能一个集群实现。 Invocati">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="http://yoursite.com/2018/08/22/dubbo-相关/images/fce799af888ea1e2b757476b03d4ded7.png">
<meta property="og:image" content="http://yoursite.com/2018/08/22/dubbo-相关/images/075a4cbace1c6874c04ae34c6b91c7ad.png">
<meta property="og:image" content="http://yoursite.com/2018/08/22/dubbo-相关/images/c48a88cbce65d737293a41250ea58d72.png">
<meta property="og:updated_time" content="2019-10-11T06:31:29.398Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="dubbo 相关">
<meta name="twitter:description" content="Dubbo领域模型在 Dubbo 的核心领域模型中：  Protocol 是服务域，它是 Invoker 暴露和引用的主功能入口，它负责 Invoker 的生命周期管理。 Invoker 是实体域，它是 Dubbo 的核心模型，其它模型都向它靠扰，或转换成它，它代表一个可执行体，可向它发起 invoke 调用，它有可能是一个本地的实现，也可能是一个远程的实现，也可能一个集群实现。 Invocati">
<meta name="twitter:image" content="http://yoursite.com/2018/08/22/dubbo-相关/images/fce799af888ea1e2b757476b03d4ded7.png">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post","offset":12,"offset_float":0,"b2t":false,"scrollpercent":false},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://yoursite.com/2018/08/22/dubbo-相关/">





  <title> dubbo 相关 | Leon </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="zh-CN">

  














  
  
    
  

  <div class="container one-collumn sidebar-position-left page-post-detail ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Leon</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
      
        <p class="site-subtitle">Live for Real</p>
      
  </div>

  <div class="site-nav-toggle">
    <button>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br>
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br>
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br>
            
            Tags
          </a>
        </li>
      
        
        <li class="menu-item menu-item-commonweal">
          <a href="/404.html" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-heartbeat"></i> <br>
            
            Commonweal 404
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2018/08/22/dubbo-相关/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="Leon">
      <meta itemprop="description" content>
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Leon">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                dubbo 相关
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2018-08-22T14:00:42+08:00">
                2018-08-22
              </time>
            

            

            
          </span>

          

          
            
          

          
          

          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="Dubbo"><a href="#Dubbo" class="headerlink" title="Dubbo"></a><a href="https://zhuanlan.zhihu.com/p/45846108" target="_blank" rel="noopener">Dubbo</a></h1><h2 id="领域模型"><a href="#领域模型" class="headerlink" title="领域模型"></a>领域模型</h2><p>在 Dubbo 的核心领域模型中：</p>
<ul>
<li><code>Protocol</code> 是服务域，它是 Invoker 暴露和引用的主功能入口，它负责 Invoker 的生命周期管理。</li>
<li><code>Invoker</code> 是实体域，它是 Dubbo 的核心模型，其它模型都向它靠扰，或转换成它，它代表一个可执行体，可向它发起 invoke 调用，它有可能是一个本地的实现，也可能是一个远程的实现，也可能一个集群实现。</li>
<li><code>Invocation</code> 是会话域，它持有调用过程中的变量，比如方法名，参数等。</li>
</ul>
<h2 id="基本设计原则"><a href="#基本设计原则" class="headerlink" title="基本设计原则"></a>基本设计原则</h2><ul>
<li>采用 <code>Microkernel + Plugin</code> 模式，Microkernel 只负责组装 Plugin，Dubbo 自身的功能也是通过扩展点实现的，也就是 Dubbo 的所有功能点都可被用户自定义扩展所替换。</li>
<li>采用 URL 作为配置信息的统一格式，所有扩展点都通过传递 URL 携带配置信息。</li>
</ul>
<h2 id="Dubbo-服务暴露过程"><a href="#Dubbo-服务暴露过程" class="headerlink" title="Dubbo 服务暴露过程"></a>Dubbo 服务暴露过程</h2><p><a href="https://dubbo.incubator.apache.org/zh-cn/docs/source_code_guide/export-service.html" target="_blank" rel="noopener">官方文档–服务导出</a></p>
<p><img src="images/fce799af888ea1e2b757476b03d4ded7.png" alt="image"></p>
<h2 id="Dubbo-结构"><a href="#Dubbo-结构" class="headerlink" title="Dubbo 结构"></a>Dubbo 结构</h2><ul>
<li>第一层：service 层，接口层，给服务提供者和消费者来实现的</li>
<li>第二层：config 层，配置层，主要是对 dubbo 进行各种配置的</li>
<li>第三层：proxy 层，服务代理层，无论是 consumer 还是 provider，dubbo 都会给你生成代理，代理之间进行网络通信</li>
<li>第四层：registry 层，服务注册层，负责服务的注册与发现</li>
<li>第五层：cluster 层，集群层，封装多个服务提供者的路由以及负载均衡，将多个实例组合成一个服务</li>
<li>第六层：monitor 层，监控层，对 rpc 接口的调用次数和调用时间进行监控</li>
<li>第七层：protocal 层，远程调用层，封装 rpc 调用</li>
<li>第八层：exchange 层，信息交换层，封装请求响应模式，同步转异步</li>
<li>第九层：transport 层，网络传输层，抽象 mina 和 netty 为统一接口</li>
<li>第十层：serialize 层，数据序列化层</li>
</ul>
<h2 id="工作流程"><a href="#工作流程" class="headerlink" title="工作流程"></a>工作流程</h2><ul>
<li>第一步：provider 向注册中心去注册</li>
<li>第二步：consumer 从注册中心订阅服务，注册中心会通知 consumer 注册好的服务</li>
<li>第三步：consumer 调用 provider</li>
<li>第四步：consumer 和 provider 都异步通知监控中心</li>
</ul>
<p><img src="images/075a4cbace1c6874c04ae34c6b91c7ad.png" alt="image"></p>
<h2 id="注册中心挂了可以继续通信吗？"><a href="#注册中心挂了可以继续通信吗？" class="headerlink" title="注册中心挂了可以继续通信吗？"></a>注册中心挂了可以继续通信吗？</h2><p>可以，因为刚开始初始化的时候，消费者会将提供者的地址等信息拉取到 <strong>本地缓存</strong>，所以注册中心挂了可以继续通信。</p>
<h2 id="Dubbo-支持哪些序列化协议？说一下-Hessian-的数据结构？PB-知道吗？为什么-PB-的效率是最高的？"><a href="#Dubbo-支持哪些序列化协议？说一下-Hessian-的数据结构？PB-知道吗？为什么-PB-的效率是最高的？" class="headerlink" title="Dubbo 支持哪些序列化协议？说一下 Hessian 的数据结构？PB 知道吗？为什么 PB 的效率是最高的？"></a>Dubbo 支持哪些序列化协议？说一下 Hessian 的数据结构？PB 知道吗？为什么 PB 的效率是最高的？</h2><h3 id="Dubbo-支持不同的通信协议"><a href="#Dubbo-支持不同的通信协议" class="headerlink" title="Dubbo 支持不同的通信协议"></a>Dubbo 支持不同的通信协议</h3><ul>
<li><strong>dubbo 协议</strong>：默认就是走 dubbo 协议，<strong>单一长连接</strong>，进行的是 NIO 异步通信，基于 hessian 作为序列化协议。使用的场景是：传输数据量小（每次请求在 100kb 以内），但是并发量很高。</li>
<li><strong>rmi 协议</strong>：走 Java 二进制序列化，<strong>多个短连接</strong>，适合消费者和提供者数量差不多的情况，适用于文件的传输，一般较少用。</li>
<li><strong>hessian 协议</strong>：走 hessian 序列化协议，<strong>多个短连接</strong>，适用于提供者数量比消费者数量还多的情况，适用于文件的传输，一般较少用。</li>
<li><strong>http 协议</strong>：走 json 序列化</li>
<li><strong>webservice</strong>：走 SOAP 文本序列化</li>
</ul>
<h3 id="Dubbo-支持的序列化协议"><a href="#Dubbo-支持的序列化协议" class="headerlink" title="Dubbo 支持的序列化协议"></a>Dubbo 支持的序列化协议</h3><p><code>dubbo</code> 支持 <code>hession</code> 、 Java 二进制序列化、<code>json</code>、<code>SOAP</code> 文本序列化多种序列化协议。但是 <strong><code>hessian</code> 是其默认的序列化协议</strong>。</p>
<h3 id="为什么-PB-的效率是最高的？"><a href="#为什么-PB-的效率是最高的？" class="headerlink" title="为什么 PB 的效率是最高的？"></a>为什么 PB 的效率是最高的？</h3><p>其实 PB 之所以性能如此好，主要得益于两个：</p>
<ul>
<li>它使用 <code>proto</code> 编译器，自动进行序列化和反序列化，速度非常快，应该比 XML 和 JSON 快上了 <code>20~100</code> 倍；</li>
<li>它的数据压缩效果好，就是说它序列化后的数据量体积小。因为体积小，传输起来带宽和速度上会有优化。</li>
</ul>
<h2 id="dubbo-负载均衡策略和集群容错策略都有哪些？动态代理策略呢？"><a href="#dubbo-负载均衡策略和集群容错策略都有哪些？动态代理策略呢？" class="headerlink" title="dubbo 负载均衡策略和集群容错策略都有哪些？动态代理策略呢？"></a>dubbo 负载均衡策略和集群容错策略都有哪些？动态代理策略呢？</h2><h3 id="dubbo-负载均衡策略"><a href="#dubbo-负载均衡策略" class="headerlink" title="dubbo 负载均衡策略"></a>dubbo 负载均衡策略</h3><h4 id="random-loadbalance"><a href="#random-loadbalance" class="headerlink" title="random loadbalance"></a>random loadbalance</h4><p>默认情况下，dubbo 是 <code>random load balance</code> ，即 <strong>随机</strong> 调用实现负载均衡，可以对 <code>provider</code> 不同实例 <strong>设置不同的权重</strong>，会按照权重来负载均衡，权重越大分配流量越高，一般就用这个默认的就可以了。</p>
<h4 id="roundrobin-loadbalance"><a href="#roundrobin-loadbalance" class="headerlink" title="roundrobin loadbalance"></a>roundrobin loadbalance</h4><p>这个的话默认就是均匀地将流量打到各个机器上去，但是如果各个机器的性能不一样，容易导致性能差的机器负载过高。所以此时需要调整权重，让性能差的机器承载权重小一些，流量少一些。</p>
<h4 id="leastactive-loadbalance"><a href="#leastactive-loadbalance" class="headerlink" title="leastactive loadbalance"></a>leastactive loadbalance</h4><p>这个就是自动感知一下，如果某个机器性能越差，那么接收的请求越少，越不活跃，此时就会给 <strong>不活跃的性能差的机器更少的请求</strong>。</p>
<h4 id="consistanthash-loadbalance"><a href="#consistanthash-loadbalance" class="headerlink" title="consistanthash loadbalance"></a>consistanthash loadbalance</h4><p>一致性 Hash 算法，相同参数的请求一定分发到一个 <code>provider</code> 上去， <code>provider</code> 挂掉的时候，会基于虚拟节点均匀分配剩余的流量，抖动不会太大。<strong>如果你需要的不是随机负载均衡</strong>，是要一类请求都到一个节点，那就走这个一致性 <code>Hash</code> 策略。</p>
<h3 id="dubbo-集群容错策略"><a href="#dubbo-集群容错策略" class="headerlink" title="dubbo 集群容错策略"></a>dubbo 集群容错策略</h3><h4 id="failover-cluster-模式"><a href="#failover-cluster-模式" class="headerlink" title="failover cluster 模式"></a>failover cluster 模式</h4><p>失败自动切换，自动重试其他机器，默认就是这个，常见于读操作。（失败重试其它机器）</p>
<h4 id="failfast-cluster模式"><a href="#failfast-cluster模式" class="headerlink" title="failfast cluster模式"></a>failfast cluster模式</h4><p>一次调用失败就立即失败，常见于写操作。（调用失败就立即失败）</p>
<h4 id="failsafe-cluster-模式"><a href="#failsafe-cluster-模式" class="headerlink" title="failsafe cluster 模式"></a>failsafe cluster 模式</h4><p>出现异常时忽略掉，常用于不重要的接口调用，比如记录日志。</p>
<h4 id="failback-cluster-模式"><a href="#failback-cluster-模式" class="headerlink" title="failback cluster 模式"></a>failback cluster 模式</h4><p>失败了后台自动记录请求，然后定时重发，比较适合于写消息队列这种。</p>
<h4 id="forking-cluster-模式"><a href="#forking-cluster-模式" class="headerlink" title="forking cluster 模式"></a>forking cluster 模式</h4><p><strong>并行调用</strong> 多个 <code>provider</code> ，只要一个成功就立即返回。</p>
<h4 id="broadcacst-cluster"><a href="#broadcacst-cluster" class="headerlink" title="broadcacst cluster"></a>broadcacst cluster</h4><p>逐个调用所有的 <code>provider。</code></p>
<h3 id="dubbo动态代理策略"><a href="#dubbo动态代理策略" class="headerlink" title="dubbo动态代理策略"></a>dubbo动态代理策略</h3><p>默认使用 <code>javassist</code> 动态字节码生成，创建代理类。但是可以通过 spi 扩展机制配置自己的动态代理策略。</p>
<h2 id="dubbo-的-spi-思想是什么？"><a href="#dubbo-的-spi-思想是什么？" class="headerlink" title="dubbo 的 spi 思想是什么？"></a>dubbo 的 spi 思想是什么？</h2><p><code>spi</code> ，简单来说，就是 <code>service provider interface</code>，说白了是什么意思呢，比如你有个接口，现在这个接口有 3 个实现类，那么在系统运行的时候对这个接口到底选择哪个实现类呢？这就需要 <code>spi</code> 了，需要根据指定的配置或者是默认的配置，去找到对应的实现类加载进来，然后用这个实现类的实例对象。</p>
<p><code>dubbo</code> 也用了 <code>spi</code> 思想，不过没有用 <code>jdk</code> 的 <code>spi</code> 机制，是自己实现的一套 <code>spi</code> 机制。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Protocol protocol = ExtensionLoader.getExtensionLoader(Protocol.class).getAdaptiveExtension();</span><br></pre></td></tr></table></figure>

<p><code>Protocol</code> 接口，在系统运行的时候， <code>dubbo</code> 会判断一下应该选用这个 <code>Protocol</code> 接口的哪个实现类来实例化对象来使用。</p>
<p>它会去找一个你配置的 <code>Protocol</code> ，将你配置的 <code>Protocol</code> 实现类，加载到 <code>jvm</code> 中来，然后实例化对象，就用你的那个 <code>Protocol</code> 实现类就可以了。</p>
<h2 id="如何基于-Dubbo-进行服务治理、服务降级、失败重试以及超时重试？"><a href="#如何基于-Dubbo-进行服务治理、服务降级、失败重试以及超时重试？" class="headerlink" title="如何基于 Dubbo 进行服务治理、服务降级、失败重试以及超时重试？"></a>如何基于 Dubbo 进行服务治理、服务降级、失败重试以及超时重试？</h2><h3 id="服务治理"><a href="#服务治理" class="headerlink" title="服务治理"></a>服务治理</h3><h4 id="1-调用链路自动生成"><a href="#1-调用链路自动生成" class="headerlink" title="1. 调用链路自动生成"></a>1. 调用链路自动生成</h4><p>一个大型的分布式系统，或者说是用现在流行的微服务架构来说吧，<strong>分布式系统由大量的服务组成</strong>。那么这些服务之间互相是如何调用的？调用链路是啥？说实话，几乎到后面没人搞的清楚了，因为服务实在太多了，可能几百个甚至几千个服务。</p>
<p>那就需要基于 dubbo 做的分布式系统中，对各个服务之间的调用自动记录下来，然后自动将 <strong>各个服务之间的依赖关系和调用链路生成出来</strong>，做成一张图，显示出来，大家才可以看到对吧。</p>
<p><img src="images/c48a88cbce65d737293a41250ea58d72.png" alt="image"></p>
<h4 id="2-服务访问压力以及时长统计"><a href="#2-服务访问压力以及时长统计" class="headerlink" title="2. 服务访问压力以及时长统计"></a>2. 服务访问压力以及时长统计</h4><p>需要自动统计 <strong>各个接口和服务之间的调用次数以及访问延时</strong>，而且要分成两个级别。</p>
<ul>
<li>一个级别是接口粒度，就是每个服务的每个接口每天被调用多少次，<code>TP50/TP90/TP99</code>，三个档次的请求延时分别是多少；</li>
<li>第二个级别是从源头入口开始，一个完整的请求链路经过几十个服务之后，完成一次请求，每天全链路走多少次，全链路请求延时的 <code>TP50/TP90/TP99</code>，分别是多少。</li>
</ul>
<p>这些东西都搞定了之后，后面才可以来看当前系统的压力主要在哪里，如何来扩容和优化啊。</p>
<h4 id="3-其它"><a href="#3-其它" class="headerlink" title="3. 其它"></a>3. 其它</h4><ul>
<li>服务分层（避免循环依赖）</li>
<li>调用链路失败监控和报警</li>
<li>服务鉴权</li>
<li>每个服务的可用性的监控（接口调用成功率？几个 9？99.99%，99.9%，99%）</li>
</ul>
<h3 id="服务降级"><a href="#服务降级" class="headerlink" title="服务降级"></a>服务降级</h3><p>比如说服务 A 调用服务 B，结果服务 B 挂掉了，服务 A 重试几次调用服务 B，还是不行，那么直接降级，走一个备用的逻辑，给用户返回响应。</p>
<p>举个栗子，我们有接口 <code>HelloService</code>。<code>HelloServiceImpl</code> 有该接口的具体实现。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">public interface HelloService &#123;</span><br><span class="line">   void sayHello();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">public class HelloServiceImpl implements HelloService &#123;</span><br><span class="line">    public void sayHello() &#123;</span><br><span class="line">        System.out.println(&quot;hello world......&quot;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xmlns:dubbo</span>=<span class="string">"http://code.alibabatech.com/schema/dubbo"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans        http://www.springframework.org/schema/beans/spring-beans.xsd        http://code.alibabatech.com/schema/dubbo        http://code.alibabatech.com/schema/dubbo/dubbo.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:application</span> <span class="attr">name</span>=<span class="string">"dubbo-provider"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">address</span>=<span class="string">"zookeeper://127.0.0.1:2181"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:protocol</span> <span class="attr">name</span>=<span class="string">"dubbo"</span> <span class="attr">port</span>=<span class="string">"20880"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:service</span> <span class="attr">interface</span>=<span class="string">"com.zhss.service.HelloService"</span> <span class="attr">ref</span>=<span class="string">"helloServiceImpl"</span> <span class="attr">timeout</span>=<span class="string">"10000"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"helloServiceImpl"</span> <span class="attr">class</span>=<span class="string">"com.zhss.service.HelloServiceImpl"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xmlns:dubbo</span>=<span class="string">"http://code.alibabatech.com/schema/dubbo"</span></span></span><br><span class="line"><span class="tag">    <span class="attr">xsi:schemaLocation</span>=<span class="string">"http://www.springframework.org/schema/beans        http://www.springframework.org/schema/beans/spring-beans.xsd        http://code.alibabatech.com/schema/dubbo        http://code.alibabatech.com/schema/dubbo/dubbo.xsd"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:application</span> <span class="attr">name</span>=<span class="string">"dubbo-consumer"</span>  /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:registry</span> <span class="attr">address</span>=<span class="string">"zookeeper://127.0.0.1:2181"</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">id</span>=<span class="string">"fooService"</span> <span class="attr">interface</span>=<span class="string">"com.test.service.FooService"</span>  <span class="attr">timeout</span>=<span class="string">"10000"</span> <span class="attr">check</span>=<span class="string">"false"</span> <span class="attr">mock</span>=<span class="string">"return null"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dubbo:reference</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>我们调用接口失败的时候，可以通过 <code>mock</code> 统一返回 <code>null</code> 。</p>
<p>mock 的值也可以修改为 true，然后再跟接口同一个路径下实现一个 Mock 类，命名规则是 “接口名称+<code>Mock</code>” 后缀。然后在 Mock 类里实现自己的降级逻辑。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">public class HelloServiceMock implements HelloService &#123;</span><br><span class="line">    public void sayHello() &#123;</span><br><span class="line">        // 降级逻辑</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="失败重试和超时重试"><a href="#失败重试和超时重试" class="headerlink" title="失败重试和超时重试"></a>失败重试和超时重试</h3><p>所谓失败重试，就是 <code>consumer</code> 调用 <code>provider</code> 要是失败了，比如抛异常了，此时应该是可以重试的，或者调用超时了也可以重试。配置如下：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dubbo:reference</span> <span class="attr">id</span>=<span class="string">"xxxx"</span> <span class="attr">interface</span>=<span class="string">"xx"</span> <span class="attr">check</span>=<span class="string">"true"</span> <span class="attr">async</span>=<span class="string">"false"</span> <span class="attr">retries</span>=<span class="string">"3"</span> <span class="attr">timeout</span>=<span class="string">"2000"</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="参考链接"><a href="#参考链接" class="headerlink" title="参考链接"></a>参考链接</h2><p><a href="https://github.com/doocs/advanced-java" target="_blank" rel="noopener">advanced-java</a></p>

      
    </div>

    <div>
      
        

      
    </div>

    <div>
      
        

      
    </div>


    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/code/" rel="tag"># code</a>
          
        </div>
      

      
        
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2018/08/12/mysql-配置安装/" rel="next" title="mysql 配置安装">
                <i class="fa fa-chevron-left"></i> mysql 配置安装
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2018/09/13/浅尝-MQ/" rel="prev" title="浅尝 MQ">
                浅尝 MQ <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </article>



    <div class="post-spread">
      
    </div>
  </div>

          
          </div>
          


          
  <div class="comments" id="comments">
    
  </div>


        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            Table of Contents
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview">
            Overview
          </li>
        </ul>
      

      <section class="site-overview sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image" src="/images/avatar.gif" alt="Leon">
          <p class="site-author-name" itemprop="name">Leon</p>
           
              <p class="site-description motion-element" itemprop="description">挪威的森林</p>
          
        </div>
        <nav class="site-state motion-element">
        
          
            <div class="site-state-item site-state-posts">
              <a href="/archives">
                <span class="site-state-item-count">14</span>
                <span class="site-state-item-name">posts</span>
              </a>
            </div>
          

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">5</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Dubbo"><span class="nav-number">1.</span> <span class="nav-text">Dubbo</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#领域模型"><span class="nav-number">1.1.</span> <span class="nav-text">领域模型</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#基本设计原则"><span class="nav-number">1.2.</span> <span class="nav-text">基本设计原则</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Dubbo-服务暴露过程"><span class="nav-number">1.3.</span> <span class="nav-text">Dubbo 服务暴露过程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Dubbo-结构"><span class="nav-number">1.4.</span> <span class="nav-text">Dubbo 结构</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#工作流程"><span class="nav-number">1.5.</span> <span class="nav-text">工作流程</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#注册中心挂了可以继续通信吗？"><span class="nav-number">1.6.</span> <span class="nav-text">注册中心挂了可以继续通信吗？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Dubbo-支持哪些序列化协议？说一下-Hessian-的数据结构？PB-知道吗？为什么-PB-的效率是最高的？"><span class="nav-number">1.7.</span> <span class="nav-text">Dubbo 支持哪些序列化协议？说一下 Hessian 的数据结构？PB 知道吗？为什么 PB 的效率是最高的？</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Dubbo-支持不同的通信协议"><span class="nav-number">1.7.1.</span> <span class="nav-text">Dubbo 支持不同的通信协议</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Dubbo-支持的序列化协议"><span class="nav-number">1.7.2.</span> <span class="nav-text">Dubbo 支持的序列化协议</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#为什么-PB-的效率是最高的？"><span class="nav-number">1.7.3.</span> <span class="nav-text">为什么 PB 的效率是最高的？</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#dubbo-负载均衡策略和集群容错策略都有哪些？动态代理策略呢？"><span class="nav-number">1.8.</span> <span class="nav-text">dubbo 负载均衡策略和集群容错策略都有哪些？动态代理策略呢？</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#dubbo-负载均衡策略"><span class="nav-number">1.8.1.</span> <span class="nav-text">dubbo 负载均衡策略</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#random-loadbalance"><span class="nav-number">1.8.1.1.</span> <span class="nav-text">random loadbalance</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#roundrobin-loadbalance"><span class="nav-number">1.8.1.2.</span> <span class="nav-text">roundrobin loadbalance</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#leastactive-loadbalance"><span class="nav-number">1.8.1.3.</span> <span class="nav-text">leastactive loadbalance</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#consistanthash-loadbalance"><span class="nav-number">1.8.1.4.</span> <span class="nav-text">consistanthash loadbalance</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#dubbo-集群容错策略"><span class="nav-number">1.8.2.</span> <span class="nav-text">dubbo 集群容错策略</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#failover-cluster-模式"><span class="nav-number">1.8.2.1.</span> <span class="nav-text">failover cluster 模式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#failfast-cluster模式"><span class="nav-number">1.8.2.2.</span> <span class="nav-text">failfast cluster模式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#failsafe-cluster-模式"><span class="nav-number">1.8.2.3.</span> <span class="nav-text">failsafe cluster 模式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#failback-cluster-模式"><span class="nav-number">1.8.2.4.</span> <span class="nav-text">failback cluster 模式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#forking-cluster-模式"><span class="nav-number">1.8.2.5.</span> <span class="nav-text">forking cluster 模式</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#broadcacst-cluster"><span class="nav-number">1.8.2.6.</span> <span class="nav-text">broadcacst cluster</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#dubbo动态代理策略"><span class="nav-number">1.8.3.</span> <span class="nav-text">dubbo动态代理策略</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#dubbo-的-spi-思想是什么？"><span class="nav-number">1.9.</span> <span class="nav-text">dubbo 的 spi 思想是什么？</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#如何基于-Dubbo-进行服务治理、服务降级、失败重试以及超时重试？"><span class="nav-number">1.10.</span> <span class="nav-text">如何基于 Dubbo 进行服务治理、服务降级、失败重试以及超时重试？</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#服务治理"><span class="nav-number">1.10.1.</span> <span class="nav-text">服务治理</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#1-调用链路自动生成"><span class="nav-number">1.10.1.1.</span> <span class="nav-text">1. 调用链路自动生成</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#2-服务访问压力以及时长统计"><span class="nav-number">1.10.1.2.</span> <span class="nav-text">2. 服务访问压力以及时长统计</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#3-其它"><span class="nav-number">1.10.1.3.</span> <span class="nav-text">3. 其它</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#服务降级"><span class="nav-number">1.10.2.</span> <span class="nav-text">服务降级</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#失败重试和超时重试"><span class="nav-number">1.10.3.</span> <span class="nav-text">失败重试和超时重试</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#参考链接"><span class="nav-number">1.11.</span> <span class="nav-text">参考链接</span></a></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2019</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Leon</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    
    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  




  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=5.1.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=5.1.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	





  





  





  



  
  

  

  

  

  


  

</body>
</html>
